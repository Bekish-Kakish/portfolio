<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Отзывы — Бекзат Какимов</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #1a1a1a 0%, #121212 100%);
      color: #eee;
      overflow-x: hidden;
    }

    header {
      background: #1f1f1f;
      padding: 20px;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      color: #a0e7e5;
      text-shadow: 0 0 10px #00ffff66;
    }

    nav {
      background: #272727;
      padding: 10px;
      text-align: center;
    }

    nav a {
      color: #a0e7e5;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s;
    }

    nav a:hover {
      color: #ff4c4c;
    }

    main {
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    h1, h2 {
      color: #fff;
      text-shadow: 0 0 10px #00ffff66;
      border-bottom: 2px solid #444;
      padding-bottom: 10px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .tabs button {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      background: #333;
      color: #a0e7e5;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .tabs button.active {
      background: #ff4c4c;
      color: white;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .review-form, .reviews-list {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #a0e7e5;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      background: #2b2b2b;
      border: 1px solid #444;
      color: #eee;
      border-radius: 5px;
      font-family: inherit;
      resize: none;
      box-sizing: border-box;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    textarea:focus, input:focus {
      outline: none;
      border-color: #ff4c4c;
    }

    textarea.auto-expand {
      overflow: hidden;
      min-height: 60px;
    }

    .stars {
      display: flex;
      flex-direction: row-reverse;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .stars input { display: none; }
    .stars label {
      font-size: 1.8rem;
      color: #444;
      cursor: pointer;
      transition: color 0.3s;
    }
    .stars input:checked ~ label,
    .stars label:hover,
    .stars label:hover ~ label {
      color: #ff4c4c;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      border: none;
      background: #ff4c4c;
      color: white;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background: #e03e3e;
    }

    .review-item {
      border-bottom: 1px solid #444;
      padding: 15px 0;
    }
    .review-stars {
      color: #ff4c4c;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }
    .review-name {
      color: #a0e7e5;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .review-text {
      white-space: pre-wrap;
      font-size: 1rem;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <header>Отзывы</header>
  <nav>
    <a href="index.html">Главная</a>
    <a href="about.html">О себе</a>
    <a href="projects.html">Проекты</a>
    <a href="contact.html">Контакты</a>
    <a href="reviews.html">Отзывы</a>
  </nav>

  <main>
    <div class="tabs">
      <button class="tab-button active" data-tab="write">Написать отзыв</button>
      <button class="tab-button" data-tab="view">Посмотреть отзывы</button>
    </div>

    <div id="write" class="tab-content active">
      <form class="review-form" id="reviewForm">
        <label for="name">Имя:</label>
        <input type="text" id="name" name="name" required autocomplete="off" />

        <label>Оценка:</label>
        <div class="stars">
          <input type="radio" id="star5" name="rating" value="5" /><label for="star5">★</label>
          <input type="radio" id="star4" name="rating" value="4" /><label for="star4">★</label>
          <input type="radio" id="star3" name="rating" value="3" /><label for="star3">★</label>
          <input type="radio" id="star2" name="rating" value="2" /><label for="star2">★</label>
          <input type="radio" id="star1" name="rating" value="1" /><label for="star1">★</label>
        </div>

        <label for="comment">Комментарий:</label>
        <textarea id="comment" name="comment" rows="3" class="auto-expand" required></textarea>

        <button type="submit">Отправить</button>
      </form>
    </div>

    <div id="view" class="tab-content">
      <section class="reviews-list" id="reviewsList">
        <p style="color:#888; text-align:center;">Отзывы загружаются после отправки...</p>
      </section>
    </div>
  </main>

  <script>
    // Переключение вкладок
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        tabContents.forEach(tab => tab.classList.remove('active'));
        document.getElementById(button.dataset.tab).classList.add('active');
      });
    });

    // Авторазмер textarea
    const autoExpand = textarea => {
      textarea.style.height = 'auto';
      textarea.style.height = textarea.scrollHeight + 'px';
    };
    document.querySelectorAll('textarea.auto-expand').forEach(textarea => {
      textarea.addEventListener('input', () => autoExpand(textarea));
      autoExpand(textarea);
    });

    const form = document.getElementById('reviewForm');
    const reviewsList = document.getElementById('reviewsList');

    // Функция экранирования для безопасности
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Загружает отзывы из localStorage и отображает их
    function loadReviewsLocal() {
      const reviews = JSON.parse(localStorage.getItem('reviews')) || [];
      reviewsList.innerHTML = '';
      if (reviews.length === 0) {
        reviewsList.innerHTML = '<p style="color:#888; text-align:center;">Пока нет отзывов.</p>';
        return;
      }
      reviews.forEach(({ name, rating, comment }) => {
        const div = document.createElement('div');
        div.className = 'review-item';
        div.innerHTML = `
          <div class="review-stars">${'★'.repeat(rating)}${'☆'.repeat(5 - rating)}</div>
          <div class="review-name">${escapeHtml(name)}</div>
          <div class="review-text">${escapeHtml(comment)}</div>
        `;
        reviewsList.appendChild(div);
      });
    }

    // Сохраняет отзыв в localStorage
    function saveReviewLocally(review) {
      const reviews = JSON.parse(localStorage.getItem('reviews')) || [];
      reviews.push(review);
      localStorage.setItem('reviews', JSON.stringify(reviews));
    }

    form.addEventListener('submit', async e => {
      e.preventDefault();

      const name = form.name.value.trim();
      const rating = parseInt(form.rating.value);
      const comment = form.comment.value.trim();

      if (!name || !rating || !comment) {
        alert('Заполните все поля!');
        return;
      }

      const data = { name, rating, comment };

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycby1WbdLuqivq7U7NVa30PImtcv6WY9pcZ5kpywcht70NqgYRi0w_vyMqkU5nJljgGASPw/exec', {
          method: 'POST',
          body: JSON.stringify(data),
          headers: { 'Content-Type': 'application/json' }
        });

        if (response.ok) {
          alert('Отзыв успешно отправлен!');
          saveReviewLocally(data);
          form.reset();
          autoExpand(form.comment);
          tabButtons[1].click(); // переключиться на "Посмотреть отзывы"
          loadReviewsLocal();
        } else {
          alert('Ошибка при отправке отзыва!');
        }
      } catch (err) {
        alert('Ошибка соединения: ' + err.message);
      }
    });

    // Загружаем отзывы из localStorage при загрузке страницы
    window.addEventListener('DOMContentLoaded', loadReviewsLocal);
  </script>
</body>
</html>
