<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–û—Ç–∑—ã–≤—ã ‚Äî –ë–µ–∫–∑–∞—Ç –ö–∞–∫–∏–º–æ–≤</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212; /* Dark background */
      color: #e0f0f0; /* Light text color */
      overflow-x: hidden;
      scroll-behavior: smooth;
      min-height: 100vh; /* Ensure body takes full viewport height */
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 35px 20px;
      text-align: center;
      font-size: 2.4em;
      font-weight: 800;
      color: #a0e7e5; /* Cyan-like accent color */
      letter-spacing: 1.5px;
      border-bottom: 2px solid #1e8888; /* Border for separation */
      box-shadow: 0 4px 15px rgba(0, 255, 255, 0.05); /* Subtle glow */
      background: linear-gradient(to right, #1e1e1e, #1a1a1a); /* Dark gradient background */
    }

    nav {
      display: flex;
      justify-content: center;
      gap: 25px;
      padding: 15px 0;
      background: #1a1a1a;
      border-bottom: 1px solid #2e2e2e;
      box-shadow: 0 1px 3px rgba(0, 255, 255, 0.08);
    }

    nav a {
      color: #a0e7e5;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.05em;
      padding: 6px 10px;
      border-radius: 5px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    nav a:hover,
    nav a:focus {
      background: #00cccc20; /* Light cyan hover effect */
      color: #ffffff;
    }

    main {
      flex: 1; /* Allows main to grow and push footer down */
      padding: 20px;
      max-width: 1000px; /* Adjusted width to medium */
      margin: 40px auto 60px; /* Centered with vertical margins */
      background: #1c1c1c; /* Darker background for main content */
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0, 255, 255, 0.07);
      opacity: 0;
      transform: translateY(40px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      font-size: 1.15em;
      line-height: 1.8;
      color: #d0f0f0;
    }

    main.visible {
      opacity: 1;
      transform: translateY(0);
    }

    h1, h2 {
      color: #a0e7e5; /* Cyan-like accent color */
      text-shadow: none; /* Remove previous text-shadow */
      border-bottom: 2px solid #2abdbd; /* Match new border color */
      padding-bottom: 10px;
      font-weight: 700; /* Bolder font weight */
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .tabs button {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      background: #333;
      color: #a0e7e5;
      border-radius: 5px;
      transition: background-color 0.3s;
    }

    .tabs button.active {
      background: #ff4c4c;
      color: white;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .review-form, .reviews-list {
      background: #1e1e1e; /* Slightly lighter dark background for forms/lists */
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      width: 100%; /* Ensure equal width */
      box-sizing: border-box; /* Include padding in the width calculation */
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #a0e7e5;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      background: #2b2b2b;
      border: 1px solid #444;
      color: #eee;
      border-radius: 5px;
      font-family: inherit;
      resize: none;
      box-sizing: border-box;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    textarea:focus, input:focus {
      outline: none;
      border-color: #ff4c4c;
    }

    textarea.auto-expand {
      overflow: hidden;
      min-height: 60px;
    }

    .stars {
      display: flex;
      flex-direction: row-reverse;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .stars input { display: none; }
    .stars label {
      font-size: 1.8rem;
      color: #444;
      cursor: pointer;
      transition: color 0.3s;
    }
    .stars input:checked ~ label,
    .stars label:hover,
    .stars label:hover ~ label {
      color: #ff4c4c;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      border: none;
      background: #ff4c4c;
      color: white;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover {
      background: #e03e3e;
    }

    .review-item {
      border-bottom: 1px solid #444;
      padding: 15px 0;
      position: relative;
    }
    .review-stars {
      color: #ff4c4c;
      font-size: 1.2rem;
      margin-bottom: 5px;
    }
    .review-name {
      color: #a0e7e5;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .review-text {
      white-space: pre-wrap;
      font-size: 1rem;
      line-height: 1.4;
      word-break: break-word; /* Added for overflow fix */
    }
    .review-timestamp { /* New style for timestamp */
        font-size: 0.85rem;
        color: #888;
        margin-top: 5px;
        text-align: right;
    }
    .delete-btn {
      position: absolute;
      top: 15px;
      right: 0;
      background: #ff4c4c;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 0.8rem;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .delete-btn:hover {
      background: #e03e3e;
    }

    /* Styles for pagination */
    .pagination-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #444;
    }

    .pagination-controls button {
      padding: 10px 15px;
      background: #00aaff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
      margin-top: 0; /* Override default button margin-top */
    }

    .pagination-controls button:hover:not(:disabled) {
      background: #0088cc;
    }

    .pagination-controls button:disabled {
      background: #555;
      cursor: not-allowed;
    }

    .page-indicator {
      color: #a0e7e5;
      font-weight: bold;
      font-size: 1.1em;
      align-self: center; /* Align text vertically in flex container */
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9em;
      background: #1a1a1a;
      color: #888;
      border-top: 1px solid #2a2a2a;
      margin-top: auto; /* Pushes footer to the bottom */
    }

    @media (max-width: 1050px) { /* Adjust breakpoint for smaller screens */
      main {
        max-width: 95%; /* Go back to percentage for smaller screens */
        margin: 40px 20px 60px;
      }
    }

    @media (max-width: 600px) {
      nav {
        flex-wrap: wrap;
        gap: 15px;
      }

      main {
        margin: 30px 15px 50px;
        padding: 30px 20px;
        font-size: 1.05em;
      }
    }
  </style>
</head>
<body>
  <header>–ë–µ–∫–∑–∞—Ç –ö–∞–∫–∏–º–æ–≤ ‚Äî –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</header>
  <nav>
    <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
    <a href="about.html">–û —Å–µ–±–µ</a>
    <a href="projects.html">–ü—Ä–æ–µ–∫—Ç—ã</a>
    <a href="reviews.html">–û—Ç–∑—ã–≤—ã</a>
  </nav>

  <main id="main-content">
    <!-- Login button will be inserted here by JS -->

    <div class="tabs">
      <button class="tab-button active" data-tab="write">–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤</button>
      <button class="tab-button" data-tab="view">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∑—ã–≤—ã</button>
    </div>

    <div id="write" class="tab-content active">
      <form class="review-form" id="reviewForm">
        <label for="name">–ò–º—è:</label>
        <input type="text" id="name" name="name" required autocomplete="off" />

        <label>–û—Ü–µ–Ω–∫–∞:</label>
        <div class="stars">
          <input type="radio" id="star5" name="rating" value="5" /><label for="star5">‚òÖ</label>
          <input type="radio" id="star4" name="rating" value="4" /><label for="star4">‚òÖ</label>
          <input type="radio" id="star3" name="rating" value="3" /><label for="star3">‚òÖ</label>
          <input type="radio" id="star2" name="rating" value="2" /><label for="star2">‚òÖ</label>
          <input type="radio" id="star1" name="rating" value="1" /><label for="star1">‚òÖ</label>
        </div>

        <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
        <textarea id="comment" name="comment" rows="3" class="auto-expand" required></textarea>

        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>
    </div>

    <div id="view" class="tab-content">
      <section class="reviews-list" id="reviewsList">
        <p style="color:#888; text-align:center;">–û—Ç–∑—ã–≤—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</p>
      </section>
      <!-- Pagination Controls -->
      <div class="pagination-controls">
        <button id="prevPageBtn" disabled>–ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="pageIndicator" class="page-indicator">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
        <button id="nextPageBtn">–°–ª–µ–¥—É—é—â–∞—è</button>
      </div>
    </div>
  </main>

  <footer>¬© 2025 –ë–µ–∫–∑–∞—Ç –ö–∞–∫–∏–º–æ–≤ DS-24–ë</footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyARTah6meZqkJAyQL5FYrNXlVWtYk_QMaM",
      authDomain: "bekish-portfolio.firebaseapp.com",
      projectId: "bekish-portfolio",
      storageBucket: "bekish-portfolio.firebasestorage.app",
      messagingSenderId: "192609156605",
      appId: "1:192609156605:web:0c923246558f58148ead94",
      measurementId: "G-Q2X3PT2VXB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    const main = document.querySelector('main');

    // –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
    let loginBtn = document.createElement('button');
    loginBtn.textContent = '–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google';
    loginBtn.style.marginBottom = '20px';
    loginBtn.style.background = '#00aaff';
    loginBtn.style.color = 'white';
    loginBtn.style.border = 'none';
    loginBtn.style.padding = '10px 20px';
    loginBtn.style.borderRadius = '5px';
    loginBtn.style.cursor = 'pointer';

    // –í—Å—Ç–∞–≤–∏–º –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ –≤—ã—à–µ —Ç–∞–±–æ–≤
    main.insertBefore(loginBtn, main.firstChild);

    let currentUser = null;

    loginBtn.addEventListener('click', () => {
      if (currentUser) {
        auth.signOut();
      } else {
        auth.signInWithPopup(provider)
          .catch(console.error);
      }
    });

    auth.onAuthStateChanged(user => {
      currentUser = user;
      if (user) {
        loginBtn.textContent = `–í—ã–π—Ç–∏ (${user.displayName})`;
      } else {
        loginBtn.textContent = '–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google';
      }
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å–±—Ä–∞—Å—ã–≤–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—é
      currentPage = 0;
      paginationTokens = [null];
      loadReviews();
    });

    // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–∞–±–æ–≤
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
        if (btn.dataset.tab === 'view') {
          // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
          currentPage = 0;
          paginationTokens = [null];
          loadReviews();
        }
      });
    });

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ textarea
    const textarea = document.getElementById('comment');
    textarea.addEventListener('input', e => {
      e.target.style.height = 'auto';
      e.target.style.height = e.target.scrollHeight + 'px';
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('reviewForm').addEventListener('submit', async e => {
      e.preventDefault();

      if (!currentUser) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google!');
        return;
      }

      const name = document.getElementById('name').value.trim();
      const ratingElems = document.querySelectorAll('input[name="rating"]');
      let rating = 0;
      for (const r of ratingElems) {
        if (r.checked) {
          rating = Number(r.value);
          break;
        }
      }
      const comment = document.getElementById('comment').value.trim();

      if (!name || rating === 0 || !comment) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, –∏–Ω–∞—á–µ –æ—Ç–∑—ã–≤ –Ω–µ –ø—Ä–æ–π–¥–µ—Ç!');
        return;
      }

      try {
        await db.collection('reviews').add({
          name,
          rating,
          comment,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          uid: currentUser.uid
        });

        alert('–û—Ç–∑—ã–≤ –¥–æ–±–∞–≤–ª–µ–Ω, —Å–ø–∞—Å–∏–±–æ!');

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        e.target.reset();
        textarea.style.height = 'auto';

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–∑—ã–≤–æ–≤ –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.querySelector('.tab-button[data-tab="view"]').click();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞:', error);
        alert('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
      }
    });

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    const reviewsPerPage = 5; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    let currentPage = 0; // –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã (0-–∏–Ω–¥–µ–∫—Å–Ω—ã–π)
    // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞—á–∞–ª–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã. paginationTokens[0] - null (–¥–ª—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã).
    // paginationTokens[i] - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (i-1), –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ startAfter –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã i.
    let paginationTokens = [null];

    // –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const pageIndicator = document.getElementById('pageIndicator');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
    async function loadReviews() {
      const reviewsList = document.getElementById('reviewsList');
      reviewsList.innerHTML = '<p style="color:#888; text-align:center;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
      prevPageBtn.disabled = true;
      nextPageBtn.disabled = true;

      let query = db.collection('reviews').orderBy('createdAt', 'desc');

      // –ü—Ä–∏–º–µ–Ω—è–µ–º startAfter, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      if (currentPage > 0) {
        query = query.startAfter(paginationTokens[currentPage]);
      }

      query = query.limit(reviewsPerPage);

      try {
        const snapshot = await query.get();

        if (snapshot.empty) {
          // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞
          if (currentPage > 0) {
            // –ï—Å–ª–∏ –º—ã –Ω–µ –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –∑–Ω–∞—á–∏—Ç, –ø–µ—Ä–µ—à–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–∑—ã–≤–æ–≤
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            currentPage--;
            // –£–¥–∞–ª—è–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ "–≤ –Ω–∏–∫—É–¥–∞"
            if (paginationTokens.length > currentPage + 1) {
              paginationTokens.pop();
            }
            loadReviews(); // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            return;
          } else {
            // –ï—Å–ª–∏ –º—ã –Ω–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –æ–Ω–∞ –ø—É—Å—Ç–∞
            reviewsList.innerHTML = '<p style="color:#888; text-align:center;">–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤, –±—É–¥—å –ø–µ—Ä–≤—ã–º!</p>';
            updatePaginationButtons(snapshot); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
            return;
          }
        }

        // –ï—Å–ª–∏ –æ—Ç–∑—ã–≤—ã –µ—Å—Ç—å, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö
        renderReviews(snapshot, reviewsList);

        // –û–±–Ω–æ–≤–ª—è–µ–º paginationTokens –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        if (paginationTokens.length === currentPage + 1 && snapshot.docs.length === reviewsPerPage) {
          paginationTokens.push(snapshot.docs[snapshot.docs.length - 1]);
        }
        // –ï—Å–ª–∏ –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å –Ω–∞–∑–∞–¥ –∏ —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤–ø–µ—Ä–µ–¥,
        // —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ç–æ–∫–µ–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
        else if (paginationTokens.length > currentPage + 1) {
          paginationTokens[currentPage + 1] = snapshot.docs[snapshot.docs.length - 1];
        }


        updatePaginationButtons(snapshot);

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤:', error);
        reviewsList.innerHTML = '<p style="color:#f55; text-align:center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤.</p>';
        prevPageBtn.disabled = true;
        nextPageBtn.disabled = true;
      }
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –æ—Ç–∑—ã–≤–æ–≤
    function renderReviews(snapshot, reviewsList) {
        reviewsList.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
        const OWNER_UID = 'rUfZljx4XrX7prORLym3H5VQ7Ja2'; // <-- –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π UID Firebase

        snapshot.forEach(doc => {
            const data = doc.data();
            if (!data.name || !data.rating || !data.comment) return;

            const reviewItem = document.createElement('div');
            reviewItem.classList.add('review-item');

            let timestampText = '';
            if (data.createdAt && data.createdAt.toDate) {
                const date = data.createdAt.toDate();
                timestampText = date.toLocaleString('ru-RU', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit'
                });
            }
            const stars = '‚òÖ'.repeat(data.rating) + '‚òÜ'.repeat(5 - data.rating);

            reviewItem.innerHTML = `
                <div class="review-stars">${stars}</div>
                <div class="review-name">${escapeHTML(data.name)}</div>
                <div class="review-text">${escapeHTML(data.comment)}</div>
                ${timestampText ? `<div class="review-timestamp">${timestampText}</div>` : ''}
            `;

            if (currentUser && (currentUser.uid === data.uid || currentUser.uid === OWNER_UID)) {
                const deleteBtn = document.createElement('button');
                deleteBtn.classList.add('delete-btn');
                deleteBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
                deleteBtn.addEventListener('click', async () => {
                    alert('–¢—ã —Ç–æ—á–Ω–æ —Ö–æ—á–µ—à—å —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤? (–ù–∞–∂–º–∏ OK –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)');
                    try {
                        await db.collection('reviews').doc(doc.id).delete();
                        alert('–û—Ç–∑—ã–≤ —É–¥–∞–ª—ë–Ω.');
                        // –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.
                        // –ï—Å–ª–∏ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç –ø—É—Å—Ç–æ–π, loadReviews –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é.
                        loadReviews();
                    } catch (err) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', err);
                        alert('–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤, –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.');
                    }
                });
                reviewItem.appendChild(deleteBtn);
            }
            reviewsList.appendChild(reviewItem);
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    async function updatePaginationButtons(currentSnapshot) {
        prevPageBtn.disabled = (currentPage === 0);
        pageIndicator.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage + 1}`;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        const nextQuerySnapshot = await db.collection('reviews')
            .orderBy('createdAt', 'desc')
            .startAfter(currentSnapshot.docs[currentSnapshot.docs.length - 1])
            .limit(1)
            .get();
        nextPageBtn.disabled = nextQuerySnapshot.empty;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    prevPageBtn.addEventListener('click', () => {
        if (currentPage > 0) {
            currentPage--;
            loadReviews(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –¥–ª—è –Ω–æ–≤–æ–π —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        }
    });

    nextPageBtn.addEventListener('click', () => {
        currentPage++;
        loadReviews(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã –¥–ª—è –Ω–æ–≤–æ–π —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    });


    // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Ä–∞–∑–º–µ—Ç–∫—É –∏ –Ω–µ –¥–æ–ø—É—Å–∫–∞—Ç—å XSS
    function escapeHTML(text) {
      return text.replace(/[&<>"']/g, function (m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –æ—Ç–∑—ã–≤–æ–≤
    window.addEventListener('load', () => {
      document.getElementById('main-content').classList.add('visible');
      loadReviews(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    });
  </script>
</body>
</html>
